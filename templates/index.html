<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>AmicusIA - Inteligencia Artificial Emocional</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="AmicusIA - Tu compaÃ±ero de inteligencia artificial para apoyo emocional y conversaciones significativas">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h2>AmicusIA ðŸ’¬<br><span>Tu amigo emocional</span></h2>
        <textarea id="mensaje" rows="5" placeholder="CuÃ©ntame cÃ³mo te sientes... Comparte tus pensamientos, emociones o cualquier cosa que tengas en mente ðŸ’­"></textarea>
        <button onclick="enviarMensaje()">Analizar Emociones âœ¨</button>
        <div id="respuesta-box">
            <strong>Respuesta de AmicusIA:</strong>
            <p id="respuesta">Â¡Hola! Soy AmicusIA, tu compaÃ±ero de inteligencia artificial especializado en comprensiÃ³n emocional. Estoy aquÃ­ para escucharte, analizar tus emociones y ofrecerte apoyo personalizado. Comparte conmigo lo que sientes y pensemos juntos. ðŸ¤—</p>
        </div>
    </div>

    <script>
        // Tu funciÃ³n original EXACTAMENTE como estaba - SIN CAMBIOS
        async function enviarMensaje() {
            const mensajeInput = document.getElementById("mensaje");
            const respuestaOutput = document.getElementById("respuesta");
            const button = document.querySelector("button");
            
            try {
                // ValidaciÃ³n bÃ¡sica
                if (!mensajeInput.value.trim()) {
                    respuestaOutput.innerText = "Por favor escribe un mensaje";
                    respuestaOutput.className = "error";
                    return;
                }
                
                // Estado de carga
                button.disabled = true;
                respuestaOutput.innerText = "Pensando...";
                respuestaOutput.className = "thinking";
                
                // 1. Detectar emociÃ³n
                const emocionRes = await fetch('/api/emocion', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mensaje: mensajeInput.value })
                });
                
                if (!emocionRes.ok) {
                    throw new Error(`Error HTTP: ${emocionRes.status}`);
                }
                const emocionData = await emocionRes.json();
                
                const botchatRes = await fetch('/api/botchat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mensaje: mensajeInput.value,
                        emocion: emocionData.emocion || 'neutral'
                    })
                });
                
                if (!botchatRes.ok) {
                    const errorDetails = await botchatRes.json().catch(() => ({}));
                    throw new Error(errorDetails.error || `Error: ${botchatRes.status}`);
                }
                
                const botchatData = await botchatRes.json();
                respuestaOutput.innerText = botchatData.respuesta || "No recibÃ­ respuesta";
                respuestaOutput.className = "";
                
            } catch (error) {
                console.error("Error completo:", error);
                respuestaOutput.innerText = `Error: ${error.message}`;
                respuestaOutput.className = "error";
            } finally {
                button.disabled = false;
                mensajeInput.value = "";
            }
        }
        
        // Mejoras adicionales sin afectar tu funcionalidad
        document.addEventListener('DOMContentLoaded', function() {
            const mensajeInput = document.getElementById("mensaje");
            
            // Auto-resize del textarea
            mensajeInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 200) + 'px';
            });
            
            // Atajo de teclado - Enter para enviar
            mensajeInput.addEventListener("keydown", function(e) {
                if (e.key === "Enter" && !e.shiftKey && !e.ctrlKey) {
                    e.preventDefault();
                    enviarMensaje();
                }
            });
            
            // Focus automÃ¡tico al cargar
            mensajeInput.focus();
        });
    </script>
</body>
</html>